{"version":3,"file":"Workbench.js","sourceRoot":"","sources":["../src/Workbench.ts"],"names":[],"mappings":"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","sourcesContent":["import { find, includes } from '@dojo/shim/array';\nimport { assign } from '@dojo/shim/object';\nimport { v, w } from '@dojo/widget-core/d';\nimport { ThemeableMixin, ThemeableProperties, theme } from '@dojo/widget-core/mixins/Themeable';\nimport WidgetBase from '@dojo/widget-core/WidgetBase';\nimport Editor from './Editor';\nimport IconCss from './IconCss';\nimport { Program } from './project';\nimport Runner, { RunnerProperties } from './Runner';\nimport TreePane, { TreePaneItem } from './TreePane';\nimport { IconJson, IconResolver } from './support/icons';\nimport * as treepaneCss from './styles/treepane.m.css';\nimport * as css from './styles/workbench.m.css';\n\nconst ThemeableBase = ThemeableMixin(WidgetBase);\n\nexport interface WorkbenchProperties extends ThemeableProperties {\n\t/**\n\t * The filename that the editor should be displaying, otherwise `undefined`\n\t */\n\tfilename?: string;\n\n\t/**\n\t * An array of filenames that the workbench should be displaying in the file tree, otherwise `undefined`\n\t */\n\tfiles?: string[];\n\n\t/**\n\t * An object which expresses the icons that should be used when displaying file icons\n\t */\n\ticons?: IconJson;\n\n\t/**\n\t * The source path to the icons\n\t */\n\ticonsSourcePath?: string;\n\n\t/**\n\t * The current emitted program that the runner should be running, otherwise `undefined`\n\t */\n\tprogram?: Program;\n\n\t/**\n\t * Called when a file is opened on the workbench\n\t * @param filename The name of file that is being requested to be opened\n\t */\n\tonFileOpen?(filename: string): void;\n\n\t/**\n\t * Called when the runner completes loading the program\n\t */\n\tonRun?(): void;\n}\n\n@theme(css)\nexport default class Workbench extends ThemeableBase<WorkbenchProperties> {\n\tprivate _expanded = [ '/', '/src' ];\n\tprivate _iconResolver = new IconResolver();\n\tprivate _selected: string;\n\n\tprivate _getItemClass = (item: TreePaneItem, expanded?: boolean) => {\n\t\tif (typeof item.label === 'string') {\n\t\t\treturn item.children && item.children.length ? this._iconResolver.folder(item.label, expanded) : this._iconResolver.file(item.label);\n\t\t}\n\t}\n\n\tprivate _getTreeRoot(): TreePaneItem | undefined {\n\t\t/**\n\t\t * Add a file to a tree of files, by parsing the filename and adding generating a `TreePaneItem`\n\t\t * @param root The root to add the file to\n\t\t * @param filename The full path of the filename\n\t\t */\n\t\tfunction addFile(root: TreePaneItem, filename: string): TreePaneItem {\n\t\t\tconst endsWithPathMarker = /[\\/\\\\]$/.test(filename);\n\t\t\tconst parts = filename.split(/[\\/\\\\]/);\n\t\t\tconst deliminator = filename.split('/').length === parts.length ? '/' : '\\\\';\n\t\t\tconst idParts: string[] = [];\n\t\t\tif (parts[0] === '.') {\n\t\t\t\tidParts.push(parts.shift()!);\n\t\t\t\tif (root.id === '') {\n\t\t\t\t\troot = {\n\t\t\t\t\t\tchildren: [],\n\t\t\t\t\t\tid: '.',\n\t\t\t\t\t\tlabel: '.',\n\t\t\t\t\t\ttitle: '.'\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t\tlet parent = root;\n\t\t\twhile (parts.length) {\n\t\t\t\tconst currentPart = parts[0];\n\t\t\t\tif (!parent.children) {\n\t\t\t\t\tparent.children = [];\n\t\t\t\t}\n\t\t\t\tlet item = find(parent.children, (child) => child.label === currentPart);\n\t\t\t\tif (!item) {\n\t\t\t\t\titem = {\n\t\t\t\t\t\tid: idParts.concat(currentPart).join(deliminator),\n\t\t\t\t\t\tlabel: currentPart,\n\t\t\t\t\t\ttitle: idParts.concat(currentPart).join(deliminator)\n\t\t\t\t\t};\n\t\t\t\t\tparent.children.push(item);\n\t\t\t\t}\n\t\t\t\tparent = item;\n\t\t\t\tidParts.push(parts.shift()!);\n\t\t\t}\n\t\t\tif (endsWithPathMarker && !parent.children) {\n\t\t\t\tparent.children = [];\n\t\t\t}\n\t\t\treturn root;\n\t\t}\n\n\t\tconst { files } = this.properties;\n\t\tif (files) {\n\t\t\treturn files\n\t\t\t\t.sort((a, b) => a < b ? -1 : 1)\n\t\t\t\t.reduce((previous, current) => addFile(previous, current), {\n\t\t\t\t\tid: '',\n\t\t\t\t\tlabel: '',\n\t\t\t\t\ttitle: ''\n\t\t\t\t} as TreePaneItem);\n\t\t}\n\t}\n\n\tprivate _onItemOpen(id: string) {\n\t\tthis._selected = id;\n\t\tconst { onFileOpen } = this.properties;\n\t\tonFileOpen && onFileOpen(id);\n\t\tthis.invalidate();\n\t}\n\n\tprivate _onItemSelect(id: string) {\n\t\tthis._selected = id;\n\t\tthis.invalidate();\n\t}\n\n\tprivate _onItemToggle(id: string) {\n\t\tconst { _expanded } = this;\n\t\tif (includes(_expanded, id)) {\n\t\t\t_expanded.splice(_expanded.indexOf(id), 1);\n\t\t}\n\t\telse {\n\t\t\t_expanded.push(id);\n\t\t}\n\t\tthis.invalidate();\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\t_expanded,\n\t\t\t_getItemClass: getItemClass,\n\t\t\t_selected: selected,\n\t\t\tproperties: {\n\t\t\t\tfilename,\n\t\t\t\ticons,\n\t\t\t\ticonsSourcePath: sourcePath,\n\t\t\t\tprogram,\n\t\t\t\ttheme,\n\t\t\t\tonRun\n\t\t\t}\n\t\t} = this;\n\n\t\tif (icons && sourcePath) {\n\t\t\tthis._iconResolver.setProperties({ icons, sourcePath });\n\t\t}\n\n\t\tconst runnerProperties: RunnerProperties = assign({}, program, { key: 'runner', theme, onRun });\n\n\t\treturn v('div', {\n\t\t\tclasses: this.classes(css.root)\n\t\t}, [\n\t\t\tw(IconCss, {\n\t\t\t\tbaseClass: treepaneCss.labelFixed,\n\t\t\t\ticons,\n\t\t\t\tkey: 'icons',\n\t\t\t\tsourcePath\n\t\t\t}),\n\t\t\tv('div', {\n\t\t\t\tclasses: this.classes(css.filetree)\n\t\t\t}, [\n\t\t\t\tw(TreePane, {\n\t\t\t\t\texpanded: [ ..._expanded ],\n\t\t\t\t\tgetItemClass,\n\t\t\t\t\tkey: 'treepane',\n\t\t\t\t\troot: this._getTreeRoot(),\n\t\t\t\t\tselected,\n\t\t\t\t\ttheme,\n\n\t\t\t\t\tonItemOpen: this._onItemOpen,\n\t\t\t\t\tonItemSelect: this._onItemSelect,\n\t\t\t\t\tonItemToggle: this._onItemToggle\n\t\t\t\t})\n\t\t\t]),\n\t\t\tw(Editor, {\n\t\t\t\tfilename,\n\t\t\t\tkey: 'editor',\n\t\t\t\toptions: {\n\t\t\t\t\tminimap: { enabled: false }\n\t\t\t\t},\n\t\t\t\ttheme\n\t\t\t}),\n\t\t\tw(Runner, runnerProperties)\n\t\t]);\n\t}\n}\n"]}