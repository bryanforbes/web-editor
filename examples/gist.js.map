{"version":3,"file":"gist.js","sourceRoot":"","sources":["../../src/examples/gist.ts"],"names":[],"mappings":"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","sourcesContent":["import request from '@dojo/core/request';\nimport Task from '@dojo/core/async/Task';\nimport Editor from '../Editor';\nimport project from '../project';\nimport Runner from '../Runner';\n\nconst usernameInput = document.getElementById('username') as HTMLInputElement;\nconst loadGistsButton = document.getElementById('load-gists') as HTMLButtonElement;\nconst projectListDiv = document.getElementById('project-list') as HTMLDivElement;\nconst projectSelect = document.getElementById('project') as HTMLSelectElement;\nconst loadProjectButton = document.getElementById('load-project') as HTMLButtonElement;\nconst fileListDiv = document.getElementById('file-list') as HTMLDivElement;\nconst selectFileSelect = document.getElementById('select-file') as HTMLSelectElement;\nconst runButton = document.getElementById('run') as HTMLButtonElement;\n\nconst editorDiv = document.getElementById('editor') as HTMLDivElement;\nconst runnerIframe = document.getElementById('runner') as HTMLIFrameElement;\n\nconst editor = new Editor(editorDiv);\nconst runner = new Runner(runnerIframe);\n\ninterface GistFile {\n\t'filename': string;\n\t'type': string;\n\t'language': string;\n\t'raw_url': string;\n\t'size': number;\n}\n\ninterface Gist {\n\t'url': string;\n\t'forks_url': string;\n\t'commits_url': string;\n\t'id': string;\n\t'git_pull_url': string;\n\t'git_push_url': string;\n\t'html_url': string;\n\t'files': { [filename: string]: GistFile };\n\t'public': boolean;\n\t'created_at': string;\n\t'updated_at': string;\n\t'description': string;\n\t'comments': number;\n\t'user': string | null;\n\t'comments_url': string;\n\t'owner': {\n\t\t'login': string;\n\t\t'id': number;\n\t\t'avatar_url': string;\n\t\t'gravatar_id': string;\n\t\t'url': string;\n\t\t'html_url': string;\n\t\t'followers_url': string;\n\t\t'following_url': string;\n\t\t'gists_url': string;\n\t\t'starred_url': string;\n\t\t'subscriptions_url': string;\n\t\t'organizations_url': string;\n\t\t'repos_url': string;\n\t\t'events_url': string;\n\t\t'received_events_url': string;\n\t\t'type': string;\n\t\t'site_admin': boolean;\n\t};\n\t'truncated': boolean;\n}\n\nasync function getGists(username: string): Task<{ description: string; projectJson: string; }[]> {\n\tconst response = await request.get(`https://api.github.com/users/${username}/gists`);\n\tconst gists = await response.json<Gist[]>();\n\treturn gists\n\t\t.filter((gist) => {\n\t\t\tfor (const key in gist.files) {\n\t\t\t\treturn gist.files[key].type === 'application/json' && gist.files[key].filename.toLowerCase() === 'project.json';\n\t\t\t}\n\t\t})\n\t\t.map((gist) => {\n\t\t\tlet projectJson = '';\n\t\t\tfor (const key in gist.files) {\n\t\t\t\tconst file = gist.files[key];\n\t\t\t\tif (file.type === 'application/json' && file.filename.toLowerCase() === 'project.json') {\n\t\t\t\t\tprojectJson = file['raw_url'].replace('gist.githubusercontent.com', 'rawgit.com');\n\t\t\t\t}\n\t\t\t}\n\t\t\tconsole.log(gist.description, projectJson);\n\t\t\treturn {\n\t\t\t\tdescription: gist.description,\n\t\t\t\tprojectJson\n\t\t\t};\n\t\t});\n}\n\nasync function runButtonClick(evt: Event) {\n\tevt.preventDefault();\n\trunButton.setAttribute('disabled', 'disabled');\n\tawait runner.run();\n\trunButton.removeAttribute('disabled');\n}\n\nfunction selectFileSelectChange(evt: Event) {\n\tevt.preventDefault();\n\teditor.display(selectFileSelect.getAttribute('value')!);\n}\n\nasync function loadProjectButtonClick() {\n\tprojectSelect.setAttribute('disabled', 'disabled');\n\tloadProjectButton.setAttribute('disabled', 'disabled');\n\tawait project.load(projectSelect.value);\n\tconst projectBundle = project.get()!;\n\tconsole.log(`Loaded. Project contains ${projectBundle.files.length + projectBundle.environmentFiles.length} files.`);\n\n\t/* generate UI for selecting a file */\n\tproject.getFileNames()\n\t\t.sort((a, b) => a < b ? -1 : 1)\n\t\t.forEach((name) => {\n\t\t\tconst option = document.createElement('option');\n\t\t\toption.value = name;\n\t\t\toption.text = name;\n\t\t\tselectFileSelect.appendChild(option);\n\t\t});\n\n\tselectFileSelect.addEventListener('change', selectFileSelectChange);\n\teditor.display(selectFileSelect.value);\n\n\trunButton.addEventListener('click', runButtonClick);\n\n\tfileListDiv.classList.remove('hidden');\n}\n\nasync function loadGistsButtonClick() {\n\tconst username = usernameInput.value;\n\tconsole.log(`Loading gists for \"${username}\"...`);\n\tif (!username) {\n\t\treturn;\n\t}\n\tloadGistsButton.setAttribute('disabled', 'disabled');\n\tconst gists = await getGists(username);\n\tconsole.log(gists);\n\tif (!gists.length) {\n\t\tconsole.warn('No valid gists found.');\n\t\tloadGistsButton.removeAttribute('disabled');\n\t\treturn;\n\t}\n\tloadGistsButton.removeEventListener('click', loadGistsButtonClick);\n\tgists.forEach(({ description, projectJson }) => {\n\t\tconst option = document.createElement('option');\n\t\toption.value = projectJson;\n\t\toption.text = description;\n\t\tprojectSelect.appendChild(option);\n\t});\n\tloadProjectButton.addEventListener('click', loadProjectButtonClick);\n\tprojectListDiv.classList.remove('hidden');\n}\n\nloadGistsButton.addEventListener('click', loadGistsButtonClick);\n\nloadGistsButton.removeAttribute('disabled');\n"]}