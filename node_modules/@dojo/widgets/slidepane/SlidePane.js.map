{"version":3,"file":"SlidePane.js","sourceRoot":"","sources":["SlidePane.ts"],"names":[],"mappings":"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","sourcesContent":["import { DNode } from '@dojo/widget-core/interfaces';\nimport { ThemeableMixin, ThemeableProperties, theme } from '@dojo/widget-core/mixins/Themeable';\nimport { v } from '@dojo/widget-core/d';\nimport { WidgetBase } from '@dojo/widget-core/WidgetBase';\nimport * as animations from '../common/styles/animations.m.css';\nimport * as css from './styles/slidePane.m.css';\nimport * as iconCss from '../common/styles/icons.m.css';\nimport uuid from '@dojo/core/uuid';\n\n/**\n * Enum for left / right alignment\n */\nexport const enum Align {\n\tleft,\n\tright\n};\n\n/**\n * @type SlidePaneProperties\n *\n * Properties that can be set on a SlidePane component\n *\n * @property align            The position of the pane on the screen (Align.left or Align.right)\n * @property closeText        Hidden text used by screen readers to display for the close button\n * @property onOpen           Called when the pane opens\n * @property onRequestClose   Called when the pane is swiped closed or the underlay is clicked or tapped\n * @property open             Determines whether the pane is open or closed\n * @property title            Title to display in the pane\n * @property underlay         Determines whether a semi-transparent background shows behind the pane\n * @property width            Width of the pane in pixels\n */\nexport interface SlidePaneProperties extends ThemeableProperties {\n\talign?: Align;\n\tcloseText?: string;\n\tonOpen?(): void;\n\tonRequestClose?(): void;\n\topen?: boolean;\n\ttitle?: string;\n\tunderlay?: boolean;\n\twidth?: number;\n};\n\n/**\n * The default width of the slide pane\n */\nconst DEFAULT_WIDTH = 320;\n\n/**\n * The minimum swipe delta in px required to be counted as a swipe and not a touch / click\n */\nconst SWIPE_THRESHOLD = 5;\n\nexport const SlidePaneBase = ThemeableMixin(WidgetBase);\n\n@theme(css)\n@theme(iconCss)\nexport default class SlidePane extends SlidePaneBase<SlidePaneProperties> {\n\tprivate _content: HTMLElement;\n\tprivate _initialX: number;\n\tprivate _slideIn: boolean;\n\tprivate _swiping: boolean;\n\tprivate _titleId = uuid();\n\tprivate _transform: number;\n\tprivate _wasOpen: boolean;\n\n\tprivate _onCloseClick() {\n\t\tconst { onRequestClose } = this.properties;\n\t\tonRequestClose && onRequestClose();\n\t}\n\n\tprivate _onSwipeStart(event: MouseEvent & TouchEvent) {\n\t\tthis._swiping = true;\n\t\t// Cache initial pointer position\n\t\tthis._initialX = event.type === 'touchstart' ? event.changedTouches[0].screenX : event.pageX;\n\t\t// Clear out the last transform applied\n\t\tthis._transform = 0;\n\t}\n\n\tprivate _onSwipeMove(event: MouseEvent & TouchEvent) {\n\t\t// Ignore mouse movement when not clicking\n\t\tif (!this._swiping) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst {\n\t\t\talign = Align.left,\n\t\t\twidth = DEFAULT_WIDTH\n\t\t} = this.properties;\n\n\t\t// Current pointer position\n\t\tconst currentX = event.type === 'touchmove' ? event.changedTouches[0].screenX : event.pageX;\n\t\t// Difference between current and initial pointer position\n\t\tconst delta = align === Align.right ? currentX - this._initialX : this._initialX - currentX;\n\t\t// Transform to apply\n\t\tthis._transform = 100 * delta / width;\n\n\t\t// Prevent pane from sliding past screen edge\n\t\tif (delta <= 0) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Move the pane\n\t\tthis._content.style.transform = `translateX(${ align === Align.left ? '-' : '' }${ this._transform }%)`;\n\t}\n\n\tprivate _onSwipeEnd(event: MouseEvent & TouchEvent) {\n\t\tconst { changedTouches, pageX, target, type } = event;\n\t\tthis._swiping = false;\n\n\t\tconst {\n\t\t\talign = Align.left,\n\t\t\tonRequestClose,\n\t\t\twidth = DEFAULT_WIDTH\n\t\t} = this.properties;\n\n\t\t// Current pointer position\n\t\tconst currentX = type === 'touchend' ? changedTouches[0].screenX : pageX;\n\t\t// Difference between current and initial pointer position\n\t\tconst delta = align === Align.right ? currentX - this._initialX : this._initialX - currentX;\n\n\t\t// If the pane was swiped far enough to close\n\t\tif (delta > width / 2) {\n\t\t\t// Cache the transform to apply on next render\n\t\t\tthis._transform = 100 * delta / width;\n\t\t\tonRequestClose && onRequestClose();\n\t\t}\n\t\t// If the underlay was clicked\n\t\telse if (Math.abs(delta) < SWIPE_THRESHOLD && (!this._content || !this._content.contains(target as HTMLElement))) {\n\t\t\tonRequestClose && onRequestClose();\n\t\t}\n\t\t// If pane was not swiped far enough to close\n\t\telse if (delta > 0) {\n\t\t\t// Animate the pane back open\n\t\t\tthis._slideIn = true;\n\t\t\tthis.invalidate();\n\t\t}\n\t}\n\n\tprotected onElementCreated(element: HTMLElement, key: string) {\n\t\tif (key === 'content') {\n\t\t\telement.addEventListener('transitionend', this.invalidate.bind(this));\n\t\t\tthis._content = element;\n\t\t}\n\t}\n\n\trender(): DNode {\n\t\tconst {\n\t\t\talign = Align.left,\n\t\t\tcloseText = 'close pane',\n\t\t\tonOpen,\n\t\t\topen = false,\n\t\t\ttitle = '',\n\t\t\tunderlay = false,\n\t\t\twidth = DEFAULT_WIDTH\n\t\t} = this.properties;\n\n\t\tconst contentClasses = [\n\t\t\tcss.pane,\n\t\t\talign === Align.left ? css.left : css.right,\n\t\t\topen ? css.open : null,\n\t\t\tthis._slideIn || (open && !this._wasOpen) ? css.slideIn : null,\n\t\t\t!open && this._wasOpen ? css.slideOut : null\n\t\t];\n\n\t\tconst fixedContentClasses = [\n\t\t\tcss.paneFixed,\n\t\t\topen ? css.openFixed : null,\n\t\t\talign === Align.left ? css.leftFixed : css.rightFixed,\n\t\t\tthis._slideIn || (open && !this._wasOpen) ? css.slideInFixed : null,\n\t\t\t!open && this._wasOpen ? css.slideOutFixed : null\n\t\t];\n\n\t\tconst contentStyles: {[key: string]: any} = {\n\t\t\ttransform: '',\n\t\t\twidth: width + 'px'\n\t\t};\n\n\t\tif (!open && this._wasOpen && this._transform) {\n\t\t\t// If pane is closing because of swipe\n\t\t\tcontentStyles['transform'] = `translateX(${ align === Align.left ? '-' : '' }${ this._transform }%)`;\n\t\t}\n\t\telse if (this._slideIn && this._content) {\n\t\t\tthis._content.style.transform = '';\n\t\t}\n\n\t\topen && !this._wasOpen && onOpen && onOpen();\n\t\tthis._wasOpen = open;\n\t\tthis._slideIn = false;\n\n\t\treturn v('div', {\n\t\t\t'aria-labelledby': this._titleId,\n\t\t\tclasses: this.classes(css.root),\n\t\t\tonmousedown: this._onSwipeStart,\n\t\t\tonmousemove: this._onSwipeMove,\n\t\t\tonmouseup: this._onSwipeEnd,\n\t\t\tontouchend: this._onSwipeEnd,\n\t\t\tontouchmove: this._onSwipeMove,\n\t\t\tontouchstart: this._onSwipeStart\n\t\t}, [\n\t\t\topen ? v('div', {\n\t\t\t\tclasses: this.classes(underlay ? css.underlayVisible : null).fixed(css.underlay),\n\t\t\t\tenterAnimation: animations.fadeIn,\n\t\t\t\texitAnimation: animations.fadeOut,\n\t\t\t\tkey: 'underlay'\n\t\t\t}) : null,\n\t\t\tv('div', {\n\t\t\t\tkey: 'content',\n\t\t\t\tclasses: this.classes(...contentClasses).fixed(...fixedContentClasses),\n\t\t\t\tstyles: contentStyles\n\t\t\t}, [\n\t\t\t\ttitle ? v('div', {\n\t\t\t\t\tclasses: this.classes(css.title),\n\t\t\t\t\tkey: 'title'\n\t\t\t\t}, [\n\t\t\t\t\tv('div', { id: this._titleId }, [ title ]),\n\t\t\t\t\tv('button', {\n\t\t\t\t\t\tclasses: this.classes(css.close),\n\t\t\t\t\t\tonclick: this._onCloseClick\n\t\t\t\t\t}, [\n\t\t\t\t\t\tcloseText,\n\t\t\t\t\t\tv('i', { classes: this.classes(iconCss.icon, iconCss.closeIcon),\n\t\t\t\t\t\t\trole: 'presentation', 'aria-hidden': 'true'\n\t\t\t\t\t\t})\n\t\t\t\t\t])\n\t\t\t\t]) : null,\n\t\t\t\tv('div', { classes: this.classes(css.content) }, this.children)\n\t\t\t])\n\t\t]);\n\t}\n}\n"]}