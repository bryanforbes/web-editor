{"version":3,"file":"WeakMap.js","sourceRoot":"","sources":["WeakMap.ts"],"names":[],"mappings":"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","sourcesContent":["import { ArrayLike } from './interfaces';\nimport { hasClass } from './support/decorators';\nimport global from './support/global';\nimport { forOf, Iterable } from './iterator';\nimport './Symbol';\n\nmodule Shim {\n\tconst DELETED: any = {};\n\n\tinterface Entry<K, V> {\n\t\tkey: K;\n\t\tvalue: V;\n\t}\n\n\tfunction getUID(): number {\n\t\treturn Math.floor(Math.random() * 100000000);\n\t}\n\n\tlet generateName = (function () {\n\t\tlet startId = Math.floor(Date.now() % 100000000);\n\n\t\treturn function generateName(): string {\n\t\t\treturn '__wm' + getUID() + (startId++ + '__');\n\t\t};\n\t})();\n\n\texport class WeakMap<K, V> {\n\t\tprivate readonly _name: string;\n\t\tprivate readonly _frozenEntries: Entry<K, V>[];\n\n\t\tconstructor(iterable?: ArrayLike<[K, V]> | Iterable<[K, V]>) {\n\t\t\tObject.defineProperty(this, '_name', {\n\t\t\t\tvalue: generateName()\n\t\t\t});\n\n\t\t\tthis._frozenEntries = [];\n\n\t\t\tif (iterable) {\n\t\t\t\tforOf(iterable, ([ key, value ]: [K, V]) => this.set(key, value));\n\t\t\t}\n\t\t}\n\n\t\tprivate _getFrozenEntryIndex(key: any): number {\n\t\t\tfor (let i = 0; i < this._frozenEntries.length; i++) {\n\t\t\t\tif (this._frozenEntries[i].key === key) {\n\t\t\t\t\treturn i;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn -1;\n\t\t}\n\n\t\tdelete(key: any): boolean {\n\t\t\tif (key === undefined || key === null) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst entry: Entry<K, V> = key[this._name];\n\t\t\tif (entry && entry.key === key && entry.value !== DELETED) {\n\t\t\t\tentry.value = DELETED;\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tconst frozenIndex = this._getFrozenEntryIndex(key);\n\t\t\tif (frozenIndex >= 0) {\n\t\t\t\tthis._frozenEntries.splice(frozenIndex, 1);\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\tget(key: any): V | undefined {\n\t\t\tif (key === undefined || key === null) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\tconst entry: Entry<K, V> = key[this._name];\n\t\t\tif (entry && entry.key === key && entry.value !== DELETED) {\n\t\t\t\treturn entry.value;\n\t\t\t}\n\n\t\t\tconst frozenIndex = this._getFrozenEntryIndex(key);\n\t\t\tif (frozenIndex >= 0) {\n\t\t\t\treturn this._frozenEntries[frozenIndex].value;\n\t\t\t}\n\t\t}\n\n\t\thas(key: any): boolean {\n\t\t\tif (key === undefined || key === null) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst entry: Entry<K, V> = key[this._name];\n\t\t\tif (Boolean(entry && entry.key === key && entry.value !== DELETED)) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tconst frozenIndex = this._getFrozenEntryIndex(key);\n\t\t\tif (frozenIndex >= 0) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\tset(key: any, value?: any): Shim.WeakMap<K, V> {\n\t\t\tif (!key || (typeof key !== 'object' && typeof key !== 'function')) {\n\t\t\t\tthrow new TypeError('Invalid value used as weak map key');\n\t\t\t}\n\t\t\tlet entry: Entry<K, V> = key[this._name];\n\t\t\tif (!entry || entry.key !== key) {\n\t\t\t\tentry = Object.create(null, {\n\t\t\t\t\tkey: { value: key }\n\t\t\t\t});\n\n\t\t\t\tif (Object.isFrozen(key)) {\n\t\t\t\t\tthis._frozenEntries.push(entry);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tObject.defineProperty(key, this._name, {\n\t\t\t\t\t\tvalue: entry\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tentry.value = value;\n\t\t\treturn this;\n\t\t}\n\n\t\t[Symbol.toStringTag] = 'WeakMap';\n\t}\n}\n\n@hasClass('es6-weakmap', global.WeakMap, Shim.WeakMap)\nexport default class WeakMap<K, V> {\n\t/* istanbul ignore next */\n\tconstructor(iterable?: ArrayLike<[K, V]> | Iterable<[K, V]>) {}\n\n\t/* istanbul ignore next */\n\tdelete(key: K): boolean { throw new Error(); }\n\t/* istanbul ignore next */\n\tget(key: K): V { throw new Error(); }\n\t/* istanbul ignore next */\n\thas(key: K): boolean { throw new Error(); }\n\t/* istanbul ignore next */\n\tset(key: K, value?: V): WeakMap<K, V> { throw new Error(); }\n\t/* istanbul ignore next */\n\t[Symbol.toStringTag] = 'WeakMap';\n}\n"]}