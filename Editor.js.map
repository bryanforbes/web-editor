{"version":3,"file":"Editor.js","sourceRoot":"","sources":["../src/Editor.ts"],"names":[],"mappings":"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","sourcesContent":["import global from '@dojo/core/global';\nimport { createHandle } from '@dojo/core/lang';\nimport { queueTask } from '@dojo/core/queue';\nimport { debounce } from '@dojo/core/util';\nimport { v, w } from '@dojo/widget-core/d';\nimport { Constructor, VirtualDomProperties, WidgetProperties } from '@dojo/widget-core/interfaces';\nimport WidgetBase from '@dojo/widget-core/WidgetBase';\nimport { ThemeableMixin, ThemeableProperties, theme } from '@dojo/widget-core/mixins/Themeable';\nimport DomWrapper from '@dojo/widget-core/util/DomWrapper';\nimport project from './project';\nimport * as css from './styles/editor.m.css';\n\nconst globalMonaco: typeof monaco = global.monaco;\n\n/**\n * @type EditorProperties\n *\n * Properties that can be set on an `Editor` widget\n *\n * @property filename The filename (from the current `project`) that the editor should be displaying for editing\n * @property options Editor options that should be passed to the monaco editor when it is created\n * @property onEditorInit Called when the monaco editor is created and initialized by the widget, passing the instance of the monaco editor\n * @property onEditorLayout Called when the widget calls `.layout()` on the monaco editor\n */\nexport interface EditorProperties extends WidgetProperties, ThemeableProperties {\n\tfilename?: string;\n\toptions?: monaco.editor.IEditorOptions;\n\n\tonEditorInit?(editor: monaco.editor.IStandaloneCodeEditor): void;\n\tonEditorLayout?(): void;\n}\n\nconst EditorBase = ThemeableMixin(WidgetBase);\n\n@theme(css)\nexport default class Editor extends EditorBase<EditorProperties> {\n\tprivate _editor: monaco.editor.IStandaloneCodeEditor | undefined;\n\tprivate _EditorDom: Constructor<WidgetBase<VirtualDomProperties & WidgetProperties>>;\n\tprivate _didChangeHandle: monaco.IDisposable;\n\tprivate _onAfterRender = () => {\n\t\tif (!this._editor) {\n\t\t\tthis._editor = globalMonaco.editor.create(this._root, this.properties.options);\n\t\t\tthis._didChangeHandle = this._editor.onDidChangeModelContent(debounce(this._onDidChangeModelContent, 1000));\n\t\t\tconst { onEditorInit } = this.properties;\n\t\t\tthis._setModel();\n\t\t\tonEditorInit && onEditorInit(this._editor);\n\n\t\t\tthis.own(createHandle(() => {\n\t\t\t\tif (this._editor) {\n\t\t\t\t\tthis._editor.dispose();\n\t\t\t\t\tthis._didChangeHandle.dispose();\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\t\tthis._editor.layout();\n\t\tthis._queuedLayout = false;\n\t\tconst { onEditorLayout } = this.properties;\n\t\tonEditorLayout && onEditorLayout();\n\t}\n\tprivate _onDidChangeModelContent = () => {\n\t\tif (this.properties.filename) {\n\t\t\tproject.setFileDirty(this.properties.filename);\n\t\t}\n\t}\n\tprivate _queuedLayout = false;\n\tprivate _root: HTMLDivElement;\n\n\tprivate _setModel() {\n\t\tconst { filename } = this.properties;\n\t\tif (this._editor && filename && project.includes(filename)) {\n\t\t\tthis._editor.setModel(project.getFileModel(filename));\n\t\t}\n\t}\n\n\tconstructor() {\n\t\tsuper();\n\t\tconst root = this._root = document.createElement('div');\n\t\troot.style.height = '100%';\n\t\troot.style.width = '100%';\n\t\tthis._EditorDom = DomWrapper(root);\n\t}\n\n\tpublic render() {\n\t\t/* TODO: Refactor when https://github.com/dojo/widget-core/pull/548 published */\n\t\tif (!this._queuedLayout) {\n\t\t\t/* doing this async, during the next major task, to allow the widget to actually render */\n\t\t\tthis._queuedLayout = true;\n\t\t\tqueueTask(this._onAfterRender);\n\t\t}\n\t\tthis._setModel();\n\t\t/* TODO: Create single node when https://github.com/dojo/widget-core/issues/553 resolved */\n\t\treturn v('div', {\n\t\t\tclasses: this.classes(css.root)\n\t\t}, [ w(this._EditorDom, { key: 'editor' }) ]);\n\t}\n}\n"]}