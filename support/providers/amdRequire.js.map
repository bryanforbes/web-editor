{"version":3,"file":"amdRequire.js","sourceRoot":"","sources":["../../../src/support/providers/amdRequire.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;IAAA,8CAAyC;IACzC,sDAAiD;IAEjD,wDAAmD;IACnD,wDAAmD;IAEnD;QAAwC,sCAAQ;QAS/C,4BAAY,GAAW,EAAE,QAAa;YAAtC,YACC,iBAAO,SAQP;YAhBQ,cAAQ,GAAG,KAAK,CAAC;YAUzB,KAAI,CAAC,SAAS,GAAG,QAAQ,CAAC;YAC1B,KAAI,CAAC,OAAO,GAAG,IAAI,iBAAO,EAAE,CAAC;YAC7B,KAAI,CAAC,EAAE,GAAG,IAAI,CAAC;YACf,KAAI,CAAC,MAAM,GAAG,GAAG,CAAC;YAClB,KAAI,CAAC,UAAU,GAAG,IAAI,CAAC;YACvB,KAAI,CAAC,GAAG,GAAU,OAAQ,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;;QACvC,CAAC;QAED,wCAAW,GAAX;YACC,MAAM,CAAC,cAAI,CAAC,MAAM,CAAc,IAAI,KAAK,CAAC,2BAA2B,CAAC,CAAC,CAAC;QACzE,CAAC;QAED,iCAAI,GAAJ;YACC,MAAM,CAAC,cAAI,CAAC,MAAM,CAAC,IAAI,KAAK,CAAC,oBAAoB,CAAC,CAAC,CAAC;QACrD,CAAC;QAED,qCAAQ,GAAR;YACC,MAAM,CAAC,cAAI,CAAC,MAAM,CAAC,IAAI,KAAK,CAAC,wBAAwB,CAAC,CAAC,CAAC;QACzD,CAAC;QAED,iCAAI,GAAJ;YACC,MAAM,CAAC,cAAI,CAAC,OAAO,CAAC,OAAO,IAAI,CAAC,SAAS,KAAK,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC;QACvG,CAAC;QAED,iCAAI,GAAJ;YACC,MAAM,CAAC,cAAI,CAAC,OAAO,CAAC,OAAO,IAAI,CAAC,SAAS,KAAK,QAAQ,GAAG,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,SAAS,CAAC,QAAQ,EAAE,CAAC,CAAC;QACxH,CAAC;QACF,yBAAC;IAAD,CAAC,AAvCD,CAAwC,kBAAQ,GAuC/C;IAvCY,gDAAkB;IAyC/B;;;OAGG;IACH,qBAAoC,GAA0B;QAA1B,oBAAA,EAAA,aAA0B;QAC7D,MAAM,CAAC,oBAAoB,GAAW,EAAE,OAAwB;YAC/D,qHAAqH;YACrH,IAAM,OAAO,GAAG,mDAAmD,CAAC;YACpE,IAAM,SAAS,GAAG,eAAe,CAAC;YAClC,EAAE,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;gBAC/C,MAAM,CAAC,IAAI,cAAI,CAAqB,UAAC,OAAO,EAAE,MAAM;oBACnD,IAAM,GAAG,GAAG,GAAG,CAAC,OAAO,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC;oBACzC,IAAI,CAAC;wBACJ,GAAG,CAAC,CAAE,GAAG,CAAE,EAAE,UAAC,MAAM,IAAK,OAAA,OAAO,CAAC,IAAI,kBAAkB,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC,EAA5C,CAA4C,CAAC,CAAC;oBACxE,CAAC;oBACD,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;wBACV,MAAM,CAAC,CAAC,CAAC,CAAC;oBACX,CAAC;gBACF,CAAC,CAAC,CAAC;YACJ,CAAC;YACD,MAAM,CAAC,aAAG,CAAC,GAAG,EAAE,OAAO,CAAC,CAAC;QAC1B,CAAC,CAAC;IACH,CAAC;IAlBD,8BAkBC","sourcesContent":["import Task from '@dojo/core/async/Task';\nimport Headers from '@dojo/core/request/Headers';\nimport { Provider, RequestOptions } from '@dojo/core/request/interfaces';\nimport Response from '@dojo/core/request/Response';\nimport xhr from '@dojo/core/request/providers/xhr';\n\nexport class AMDRequireResponse extends Response {\n\tprivate _response: any;\n\treadonly bodyUsed = false;\n\treadonly headers: Headers;\n\treadonly ok: boolean;\n\treadonly status: number;\n\treadonly statusText: string;\n\treadonly url: string;\n\n\tconstructor(url: string, response: any) {\n\t\tsuper();\n\n\t\tthis._response = response;\n\t\tthis.headers = new Headers();\n\t\tthis.ok = true;\n\t\tthis.status = 200;\n\t\tthis.statusText = 'OK';\n\t\tthis.url = (<any> require).toUrl(url);\n\t}\n\n\tarrayBuffer(): Task<ArrayBuffer> {\n\t\treturn Task.reject<ArrayBuffer>(new Error('ArrayBuffer not supported'));\n\t}\n\n\tblob(): Task<Blob> {\n\t\treturn Task.reject(new Error('Blob not supported'));\n\t}\n\n\tformData(): Task<FormData> {\n\t\treturn Task.reject(new Error('FormData not supported'));\n\t}\n\n\tjson(): Task<any> {\n\t\treturn Task.resolve(typeof this._response === 'string' ? JSON.parse(this._response) : this._response);\n\t}\n\n\ttext(): Task<string> {\n\t\treturn Task.resolve(typeof this._response === 'string' ? this._response : this._response && this._response.toString());\n\t}\n}\n\n/**\n * Returns an AMD require provider that offloads to XHR, which can be bound to a localised require\n * @param req The local require to bind to\n */\nexport default function getProvider(req: NodeRequire = require): Provider {\n\treturn function amdRequire(url: string, options?: RequestOptions): Task<AMDRequireResponse> {\n\t\t/* we need to detect and rewrite URLs from @dojo/i18n/cldr/load - see issue https://github.com/dojo/i18n/issues/83 */\n\t\tconst i18nUri = /^https:\\/\\/unpkg\\.com\\/@dojo\\/i18n[^\\/]*\\/cldr\\//i;\n\t\tconst remoteUri = /^https?:\\/\\//i;\n\t\tif (i18nUri.test(url) || !remoteUri.test(url)) {\n\t\t\treturn new Task<AMDRequireResponse>((resolve, reject) => {\n\t\t\t\tconst mid = url.replace(i18nUri, 'src/');\n\t\t\t\ttry {\n\t\t\t\t\treq([ mid ], (module) => resolve(new AMDRequireResponse(mid, module)));\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\treject(e);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn xhr(url, options);\n\t};\n}\n"]}