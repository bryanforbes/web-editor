{"version":3,"file":"amdRequire.js","sourceRoot":"","sources":["../../../src/support/providers/amdRequire.ts"],"names":[],"mappings":"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","sourcesContent":["import { assign } from '@dojo/core/lang';\nimport Observable from '@dojo/core/Observable';\nimport Task from '@dojo/core/async/Task';\nimport Headers from '@dojo/core/request/Headers';\nimport { Provider, RequestOptions, UploadObservableTask } from '@dojo/core/request/interfaces';\nimport Response from '@dojo/core/request/Response';\nimport xhr from '@dojo/core/request/providers/xhr';\n\nexport class AMDRequireResponse extends Response {\n\tprivate _response: any;\n\treadonly bodyUsed = false;\n\treadonly data: Observable<any>;\n\treadonly download: Observable<number>;\n\treadonly headers = new Headers();\n\treadonly ok = true;\n\treadonly status = 200;\n\treadonly statusText = 'OK';\n\treadonly url: string;\n\n\tconstructor(url: string, response: any) {\n\t\tsuper();\n\n\t\tthis._response = response;\n\t\tthis.data = new Observable<any>((observer) => {\n\t\t\tobserver.error(new Error('Data not supported'));\n\t\t});\n\t\tthis.download = new Observable<any>((observer) => {\n\t\t\tobserver.error(new Error('Download not supported'));\n\t\t});\n\t\tthis.url = (<any> require).toUrl(url);\n\t}\n\n\tarrayBuffer(): Task<ArrayBuffer> {\n\t\treturn Task.reject<ArrayBuffer>(new Error('ArrayBuffer not supported'));\n\t}\n\n\tblob(): Task<Blob> {\n\t\treturn Task.reject(new Error('Blob not supported'));\n\t}\n\n\tformData(): Task<FormData> {\n\t\treturn Task.reject(new Error('FormData not supported'));\n\t}\n\n\tjson(): Task<any> {\n\t\treturn Task.resolve(typeof this._response === 'string' ? JSON.parse(this._response) : this._response);\n\t}\n\n\ttext(): Task<string> {\n\t\treturn Task.resolve(typeof this._response === 'string' ? this._response : this._response && this._response.toString());\n\t}\n\n\tupload(): Observable<any> {\n\t\treturn new Observable<any>((observer) => {\n\t\t\tobserver.error(new Error('Upload not supported'));\n\t\t});\n\t}\n}\n\n/**\n * Returns an AMD require provider that offloads to XHR, which can be bound to a localised require\n * @param req The local require to bind to\n */\nexport default function getProvider(req: NodeRequire = require): Provider {\n\treturn function amdRequire(url: string, options?: RequestOptions): UploadObservableTask<AMDRequireResponse> {\n\t\t/* we need to detect and rewrite URLs from @dojo/i18n/cldr/load - see issue https://github.com/dojo/i18n/issues/83 */\n\t\tconst i18nUri = /^https:\\/\\/unpkg\\.com\\/@dojo\\/i18n[^\\/]*\\/cldr\\//i;\n\t\tconst remoteUri = /^https?:\\/\\//i;\n\t\tif (i18nUri.test(url) || !remoteUri.test(url)) {\n\t\t\tconst task = new Task<AMDRequireResponse>((resolve, reject) => {\n\t\t\t\tconst mid = url.replace(i18nUri, 'src/');\n\t\t\t\ttry {\n\t\t\t\t\t(req as any)([ mid ], (module: any) => {\n\t\t\t\t\t\tresolve(new AMDRequireResponse(mid, module));\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\treject(e);\n\t\t\t\t}\n\t\t\t});\n\t\t\tassign(task, {\n\t\t\t\tupload: new Observable<any>((observer) => {\n\t\t\t\t\tobserver.error(new Error('Upload not supported'));\n\t\t\t\t})\n\t\t\t});\n\t\t\treturn task as UploadObservableTask<AMDRequireResponse>;\n\t\t}\n\t\treturn xhr(url, options) as UploadObservableTask<AMDRequireResponse>;\n\t};\n}\n"]}