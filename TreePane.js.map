{"version":3,"file":"TreePane.js","sourceRoot":"","sources":["../src/TreePane.ts"],"names":[],"mappings":"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","sourcesContent":["import { includes } from '@dojo/shim/array';\nimport Map from '@dojo/shim/Map';\nimport { v, w } from '@dojo/widget-core/d';\nimport { WNode } from '@dojo/widget-core/interfaces';\nimport WidgetBase from '@dojo/widget-core/WidgetBase';\nimport { theme, ThemeableMixin, ThemeableProperties } from '@dojo/widget-core/mixins/Themeable';\nimport ScrollBar from './ScrollBar';\nimport * as css from './styles/treepane.m.css';\nimport { getAbsolutePosition } from './support/events';\nimport { IconJson, IconResolver } from './support/icons';\n\nexport interface TreePaneItem {\n\tchildren?: TreePaneItem[];\n\tclass?: string;\n\tid: string;\n\tlabel: string;\n\ttitle: string;\n}\n\nexport interface TreePaneProperties extends ThemeableProperties {\n\texpanded: string[];\n\ticons?: IconJson;\n\tlabel?: string;\n\tselected?: string;\n\tshowRoot?: boolean;\n\tsourcePath?: string;\n\troot?: TreePaneItem;\n\n\tonItemOpen?(key?: string): void;\n\tonItemSelect?(key?: string): void;\n\tonItemToggle?(key?: string): void;\n}\n\nconst ROW_HEIGHT = 22;\nconst ThemeableBase = ThemeableMixin(WidgetBase);\n\nexport interface RowProperties extends ThemeableProperties {\n\tclass?: string;\n\texpanded?: boolean;\n\thasChildren?: boolean;\n\tlabel: string;\n\tlevel: number;\n\tselected?: boolean;\n\ttitle?: string;\n\n\tonClick?(key?: string): void;\n\tonDblClick?(key?: string): void;\n}\n\nconst ROW_LEVEL_LEFT_PADDING = 12;\n\n@theme(css)\nexport class Row extends ThemeableBase<RowProperties> {\n\tprivate _onclick() {\n\t\tthis.properties.onClick && this.properties.onClick(this.properties.key);\n\t}\n\tprivate _ondblclick() {\n\t\tthis.properties.onDblClick && this.properties.onDblClick(this.properties.key);\n\t}\n\n\trender() {\n\t\tconst classes = [ css.row, this.properties.selected && css.selected || null, this.properties.hasChildren && css.hasChildren || null, this.properties.expanded && css.expanded || null ];\n\t\treturn v('div', {\n\t\t\t'aria-level': String(this.properties.level),\n\t\t\t'aria-selected': this.properties.selected,\n\t\t\t'aria-role': 'treeitem',\n\t\t\tclasses: this.classes(...classes),\n\t\t\trole: 'treeitem',\n\t\t\tstyles: {\n\t\t\t\t'padding-left': String(this.properties.level * ROW_LEVEL_LEFT_PADDING) + 'px'\n\t\t\t},\n\t\t\tonclick: this._onclick,\n\t\t\tondblclick: this._ondblclick\n\t\t}, [\n\t\t\tv('div', {\n\t\t\t\tclasses: this.classes(css.content)\n\t\t\t}, [\n\t\t\t\tv('div', {\n\t\t\t\t\tclasses: this.classes(css.label).fixed(css.labelFixed, this.properties.class || null),\n\t\t\t\t\ttitle: this.properties.title\n\t\t\t\t}, [\n\t\t\t\t\tv('a', {\n\t\t\t\t\t\tclasses: this.classes(css.labelName)\n\t\t\t\t\t}, [ this.properties.label ])\n\t\t\t\t])\n\t\t\t])\n\t\t]);\n\t}\n}\n\n@theme(css)\nexport default class TreePane extends ThemeableBase<TreePaneProperties> {\n\tprivate _dragging = false;\n\tprivate _dragPosition: number;\n\tprivate _items = new Map<string, TreePaneItem>();\n\tprivate _resolver: IconResolver;\n\tprivate _visibleRowCount: number;\n\tprivate _scrollPosition = 0;\n\tprivate _scrollVisible = false;\n\tprivate _size: number;\n\tprivate _sliderSize: number;\n\n\tprivate _cacheItems() {\n\t\tfunction cacheItem(cache: Map<string, TreePaneItem>, item: TreePaneItem) {\n\t\t\tcache.set(item.id, item);\n\t\t\tif (item.children) {\n\t\t\t\titem.children.forEach(child => cacheItem(cache, child));\n\t\t\t}\n\t\t}\n\n\t\tif (this.properties.root) {\n\t\t\tthis._items.clear();\n\t\t\tcacheItem(this._items, this.properties.root);\n\t\t}\n\t}\n\n\tprivate _onDomUpdate(element: HTMLElement, key: string) {\n\t\tif (key === 'rows') {\n\t\t\tthis._visibleRowCount = element.clientHeight / ROW_HEIGHT;\n\t\t}\n\t}\n\n\tprivate _onDragStart(evt: TouchEvent & MouseEvent) {\n\t\tevt.preventDefault();\n\t\tthis._dragging = true;\n\t\tthis._dragPosition = getAbsolutePosition(evt);\n\t}\n\n\tprivate _onDragMove(evt: TouchEvent & MouseEvent) {\n\t\tconst {\n\t\t\t_dragging,\n\t\t\t_dragPosition\n\t\t} = this;\n\t\tif (_dragging) {\n\t\t\tevt.preventDefault();\n\t\t\tconst delta = getAbsolutePosition(evt) - _dragPosition;\n\t\t\tthis._onPositionUpdate(delta / ROW_HEIGHT);\n\t\t\tthis._dragPosition = getAbsolutePosition(evt);\n\t\t}\n\t}\n\n\tprivate _onDragEnd(evt: TouchEvent & MouseEvent) {\n\t\tevt.preventDefault();\n\t\tthis._dragging = false;\n\t}\n\n\tprivate _onmouseenter(evt: MouseEvent) {\n\t\tevt.preventDefault();\n\t\tthis._scrollVisible = true;\n\t\tthis.invalidate();\n\t}\n\n\tprivate _onmouseleave(evt: MouseEvent) {\n\t\tevt.preventDefault();\n\t\tthis._scrollVisible = false;\n\t\tthis.invalidate();\n\t}\n\n\tprivate _onPositionUpdate(delta: number): boolean {\n\t\tconst { _scrollPosition, _size, _sliderSize } = this;\n\t\tconst updatedPosition = _scrollPosition + delta;\n\t\tconst maxPosition = _size - _sliderSize + 1;\n\t\tthis._scrollPosition = updatedPosition > 0 ? updatedPosition > maxPosition ? maxPosition : updatedPosition : 0;\n\t\tif (_scrollPosition !== this._scrollPosition) {\n\t\t\tthis.invalidate();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tprivate _onRowClick(key: string) {\n\t\tthis.properties.selected !== key && this.properties.onItemSelect && this.properties.onItemSelect(key);\n\t\tconst item = this._items.get(key);\n\t\tif (!item) {\n\t\t\tthrow new Error(`Uncached TreePane row ID: \"${key}\"`);\n\t\t}\n\t\tif (item.children && this.properties.onItemToggle) {\n\t\t\tthis.properties.onItemToggle(key);\n\t\t}\n\t}\n\n\tprivate _onRowDblClick(key: string) {\n\t\tthis.properties.onItemOpen && this.properties.onItemOpen(key);\n\t}\n\n\tprivate _onScrollbarScroll = (delta: number) => {\n\t\tthis._onPositionUpdate(delta);\n\t}\n\n\tprivate _onwheel(evt: WheelEvent) {\n\t\tif (this._onPositionUpdate(evt.deltaY / ROW_HEIGHT)) {\n\t\t\tevt.preventDefault();\n\t\t}\n\t}\n\n\tprivate _renderChild(item: TreePaneItem, level: number): WNode<Row> {\n\t\tconst { children, id: key, label, title } = item;\n\t\tconst { expanded: propsExpanded, theme } = this.properties;\n\t\tconst expanded = includes(propsExpanded, key);\n\t\tconst hasChildren = Boolean(children);\n\t\treturn w(Row, {\n\t\t\tclass: hasChildren ? this._resolver.folder(label, expanded) : this._resolver.file(label),\n\t\t\texpanded,\n\t\t\thasChildren,\n\t\t\tkey,\n\t\t\tlevel,\n\t\t\tlabel,\n\t\t\tselected: this.properties.selected === key,\n\t\t\ttitle,\n\t\t\ttheme,\n\n\t\t\tonClick: this._onRowClick,\n\t\t\tonDblClick: this._onRowDblClick\n\t\t});\n\t}\n\n\tprivate _renderChildren(): (WNode<Row> | null)[] {\n\t\tconst {\n\t\t\t_scrollPosition,\n\t\t\tproperties: {\n\t\t\t\texpanded,\n\t\t\t\troot,\n\t\t\t\tshowRoot\n\t\t\t}\n\t\t} = this;\n\t\tconst children: (WNode<Row> | null)[] = [];\n\t\tconst start = _scrollPosition ? _scrollPosition - 1 : 0;\n\t\tconst end = start + this._visibleRowCount + 2;\n\t\tlet rowCount = 0;\n\n\t\tconst addChildren = (items: TreePaneItem[], level: number) => {\n\t\t\titems.forEach((item) => {\n\t\t\t\trowCount++;\n\t\t\t\tchildren.push(rowCount >= start && rowCount <= end ? this._renderChild(item, level) : null);\n\t\t\t\tif (item.children && item.children.length && includes(expanded, item.id)) {\n\t\t\t\t\taddChildren(item.children, level + 1);\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\tif (root) {\n\t\t\taddChildren(showRoot ? [ root ] : root.children || [], 1);\n\t\t}\n\n\t\treturn children;\n\t}\n\n\tpublic onElementCreated(element: HTMLElement, key: string) {\n\t\tthis._onDomUpdate(element, key);\n\t}\n\n\tpublic onElementUpdated(element: HTMLElement, key: string) {\n\t\tthis._onDomUpdate(element, key);\n\t}\n\n\tpublic render() {\n\t\tconst {\n\t\t\t_onScrollbarScroll,\n\t\t\t_resolver,\n\t\t\t_scrollPosition,\n\t\t\t_scrollVisible,\n\t\t\tproperties: {\n\t\t\t\ticons,\n\t\t\t\tkey,\n\t\t\t\tlabel,\n\t\t\t\tsourcePath,\n\t\t\t\ttheme\n\t\t\t},\n\t\t\t_visibleRowCount\n\t\t} = this;\n\t\tif (!_resolver && icons && sourcePath) {\n\t\t\tthis._resolver = new IconResolver(sourcePath, icons);\n\t\t}\n\t\tthis._cacheItems();\n\t\tconst top =  0 - (_scrollPosition % ROW_HEIGHT);\n\t\tconst rows = this._renderChildren();\n\t\tconst sliderSize = this._sliderSize = _visibleRowCount > rows.length ? rows.length : _visibleRowCount;\n\t\tconst size = this._size = rows.length;\n\t\treturn v('div', {\n\t\t\t'aria-label': label,\n\t\t\tclasses: this.classes(css.root),\n\t\t\tkey,\n\t\t\trole: 'tree',\n\n\t\t\tonmouseenter: this._onmouseenter,\n\t\t\tonmouseleave: this._onmouseleave\n\t\t}, [\n\t\t\tv('div', {\n\t\t\t\tclasses: this.classes(css.scroll),\n\t\t\t\tkey: 'rows',\n\t\t\t\trole: 'presentation',\n\t\t\t\tstyles: {\n\t\t\t\t\ttop: String(top) + 'px'\n\t\t\t\t},\n\n\t\t\t\tonmousedown: this._onDragStart,\n\t\t\t\tonmousemove: this._onDragMove,\n\t\t\t\tonmouseup: this._onDragEnd,\n\t\t\t\tontouchstart: this._onDragStart,\n\t\t\t\tontouchmove: this._onDragMove,\n\t\t\t\tontouchend: this._onDragEnd,\n\t\t\t\tonwheel: this._onwheel\n\t\t\t}, rows),\n\t\t\tw(ScrollBar, {\n\t\t\t\tposition: _scrollPosition,\n\t\t\t\tsize,\n\t\t\t\tsliderSize,\n\t\t\t\tvisible: _scrollVisible,\n\t\t\t\ttheme,\n\n\t\t\t\tonScroll: _onScrollbarScroll\n\t\t\t})\n\t\t]);\n\t}\n}\n"]}